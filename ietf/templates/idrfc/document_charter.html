{% extends "base.html" %}

{% load ietf_filters %}

{% block title %}{{ doc.canonical_name }}-{{ doc.rev }}{% endblock %}

{% block pagehead %}
<link rel="stylesheet" type="text/css" href="/css/doc.css"></link>
{% endblock %}

{% block content %}
{{ top|safe }}

<div class="snapshots">
  Snapshots:
  <span class="revisions">
    {% for rev in revisions %}
    <a {% if rev != doc.rev %}href="{% url doc_view name=doc.name %}{% if not forloop.last %}{{ rev }}/{% endif %}"{% endif %}>{{ rev }}</a>
    {% endfor %}
  </span>
</div>

<div class="ietf-box metabox">
  <div>
    {% if snapshot %}Snapshot of{% endif %}
    {% if doc.get_state_slug != "approved" %}Proposed{% endif %}
    Charter for "{{ group.name }}"
    (<a href="{% url wginfo.views.wg_charter acronym=group.acronym %}">{{ group.acronym }}</a>) {{ group.type.name }}
  </div>

  <table id="metatable" width="100%">
    <tr>
      <td>WG State:</td>
      <td>{{ group.state.name }}</td>
    </tr>
    <tr>
      <td><a href="/doc/help/state/charter/">Charter State</a>:</td>
      <td>
        <div>
        <a title="{{ doc.get_state.desc }}"{% if not snapshot and user|has_role:"Area Director,Secretariat" %} href="{% url charter_change_state name=doc.name %}"{% endif %}>{{ doc.get_state.name }}</a>
        {% if chartering == "initial" %}(Initial Chartering){% endif %}
        {% if chartering == "rechartering" %}(Rechartering){% endif %}

        {% if not snapshot and user|has_role:"Area Director,Secretariat" %}


        {% if chartering  %}
        - <a href="{% url charter_startstop_process name=doc.name option='abandon' %}">Abandon effort</a>

        {% if request.user|has_role:"Secretariat" %}
        - <a href="{% url charter_approve name=doc.name %}">Approve charter</a>
        {% endif %}

        {% else %}
          {% if group.state_id == "proposed" or group.state_id == "bof" %}
          - <a href="{% url charter_submit name=doc.name option='initcharter' %}">Start chartering</a>
          {% else %}
          - <a href="{% url charter_submit name=doc.name option='recharter' %}">Recharter</a>
          {% endif %}
        {% endif %}

        {% endif %}
        </div>

        {% if not snapshot and chartering %}
        <div class="telechat">
          {% if not telechat %}Not on agenda of IESG telechat{% else %}On agenda of {{ telechat.telechat_date|date:"Y-m-d" }} IESG telechat{% endif %}
          {% if user|has_role:"Area Director,Secretariat" %}
          - <a href="{% url charter_telechat_date name=doc.name %}">Change</a>
          {% endif %}
        </div>

        {% if ballot_summary %}
        <div class="ballot-summary">
          ({{ ballot_summary }})
        </div>
        {% endif %}

        {% endif %}
      </td>
    </tr>

    {% if chartering and group.comments %}
    <tr>
      {% if chartering == "initial" %}<td>Reason for chartering:</td>{% endif %}
      {% if chartering == "rechartering" %}<td>Reason for rechartering:</td>{% endif %}
      <td>{{ group.comments }}</td>
    </tr>
    {% endif %}

    <tr><td colspan='2'><hr size='1' noshade /></td></tr>

    <tr>
      <td>Send notices to:</td>
      <td>{{ doc.notify|default:"none" }}
          {% if user|has_role:"Area Director,Secretariat" %}
          - <a href="{% url charter_edit_notify name=doc.name %}">Change</a>
          {% endif %}
      </td>
    </tr>

    <tr><td>Last updated:</td><td> {{ doc.time|date:"Y-m-d" }}</td></tr>

    <tr><td colspan='2'><hr size='1' noshade /></td></tr>
  </table>

  <div class="actions">
    <a href="/feed/group-changes/{{ group.acronym }}/">Atom feed</a>
  </div>
</div>

<p>Other versions: <a href="{{ txt_url }}">plain text</a></p>

<h3>Charter {{ doc.canonical_name }}-{{ doc.rev }}

{% if not snapshot and user|has_role:"Area Director,Secretariat" and chartering and group.state_id != "conclude" %}
<a class="edit" href="{% url charter_submit name=doc.name %}">Change charter text</a>
{% endif %}
</h3>

{% if doc.rev %}
<div class="markup_draft">
  {{ content|safe|linebreaksbr|keep_spacing|sanitize_html|safe }}
</div>
{% endif %}

{% endblock %}

