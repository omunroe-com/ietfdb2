#!/usr/bin/env python

import datetime, os
import syslog

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "ietf.settings")

syslog.openlog(os.path.basename(__file__), syslog.LOG_PID, syslog.LOG_USER)

import django
django.setup()

from ietf.doc.lastcall import *

drafts = get_expired_last_calls()
for doc in drafts:
    try:
        expire_last_call(doc)
        syslog.syslog("Expired last call for %s (id=%s)" % (doc.file_tag(), doc.pk))
    except Exception as e:
        syslog.syslog(syslog.LOG_ERR, "ERROR: Failed to expire last call for %s (id=%s)" % (doc.file_tag(), doc.pk))
