{% extends "base.html" %}
{# Copyright The IETF Trust 2015, All Rights Reserved #}
{% load origin %}
{% load bootstrap3 %}

{% block title %}Change position for {{ ad.plain_name }} on {{ doc }}{% endblock %}

{% block content %}
  {% origin %}
  <h1>Change position for {{ ad.plain_name }}<br><small>{{ doc }}</small></h1>

  {% bootstrap_messages %}

  <div class="question">{{ ballot.ballot_type.question }}</div>

  {% if ballot_deferred %}
    <p class="alert alert-info">
      Ballot deferred by {{ ballot_deferred.by }} on {{ ballot_deferred.time|date:"Y-m-d" }}.
    </p>
  {% endif %}

  <form role="form" method="post">
    {% csrf_token %}

    {% for field in form %}
      {% bootstrap_field field %}
      {% if field.name == "discuss" and old_pos and old_pos.discuss_time %}
        <span class="help-block">Last edited {{ old_pos.discuss_time }}</span>
      {% elif field.name == "comment" and old_pos and old_pos.comment_time %}
        <span class="help-block">Last edited {{ old_pos.comment_time }}</span>
      {% endif %}
    {% endfor %}

    {% buttons %}
      <button type="submit" class="btn btn-primary" name="send_mail" value="Save and send email">Save & send email</button>
      <input type="submit" class="btn btn-default" value="Save">

      {% if doc.type_id == "draft" or doc.type_id == "conflrev" %}
        {% if ballot_deferred %}
          <input type="submit" class="btn btn-warning" name="Undefer" value="Undefer ballot">
        {% else %}
          <input type="submit" class="btn btn-danger" name="Defer" value="Defer ballot">
        {% endif %}
      {% endif %}
      <a class="btn btn-default pull-right" href="{{ doc.get_absolute_url }}">Back</a>
    {% endbuttons %}
  </form>
{% endblock %}

{% block js %}
  <script>
    var block_pos = {{ blocking_positions|safe }};

    function discussToggle(val) {
        if (val in block_pos) {
            $("#div_id_discuss").show();
        } else {
            $("#div_id_discuss").hide();
        }
    }
   
   $("input[name=position]").click(function () {
       discussToggle($(this).val());
   });

   discussToggle($("input[name=position]:checked").val());
  </script>
{% endblock %}
